{"version":3,"sources":["../src/Model.js"],"names":["Model","constructor","collection","data","driver","id","getCollection","get","key","defaultValue","Dot","set","value","setMany","o","matches","query","save","getPrimaryKeyName","formatPrimaryKey","ret","update","name","formatIn","insert","getPrimaryKey","addToCache","delete","removeFromCache"],"mappings":"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","sourcesContent":["import sift from 'sift'\r\nimport Dot from './Tools/Dot'\r\n\r\nexport default class Model {\r\n    constructor(collection, data) {\r\n        this.collection = collection\r\n        this.driver = collection.driver\r\n        this.data = data\r\n        this.id = data.id ?? null\r\n    }\r\n\r\n    getCollection() {\r\n        return this.collection\r\n    }\r\n\r\n    get(key, defaultValue = null) {\r\n        return Dot.get(this.data, key) ?? defaultValue\r\n    }\r\n\r\n    set(key, value) {\r\n        Dot.set(this.data, key, value)\r\n        return this\r\n    }\r\n\r\n    setMany(o) {\r\n        for (let key in o)\r\n            Dot.set(this.data, key, o[key])\r\n        return this\r\n    }\r\n\r\n    matches(query = {}) {\r\n        return sift(query)(this.data)\r\n    }\r\n\r\n    async save() {\r\n        if (this.id !== null) { // Update\r\n            const query = {}\r\n            query[this.driver.getPrimaryKeyName()] = this.driver.formatPrimaryKey(this.id)\r\n            const ret = await this.driver.update(\r\n                this.collection.name,\r\n                query,\r\n                await this.collection.formatIn(this.data)\r\n            )\r\n        } else { // Insert\r\n            const ret = await this.driver.insert(\r\n                this.collection.name,\r\n                await this.collection.formatIn(this.data)\r\n            )\r\n            this.id = this.driver.getPrimaryKey(ret)\r\n            this.data.id = this.id\r\n\r\n            this.collection.addToCache(this)\r\n        }\r\n        \r\n        return true\r\n    }\r\n\r\n    async delete() {\r\n        if (this.id === null)\r\n            return false\r\n        \r\n        const query = {}\r\n        query[this.driver.getPrimaryKeyName()] = this.driver.formatPrimaryKey(this.id)\r\n\r\n        const collection = this.getCollection()\r\n        const ret = await this.driver.delete(\r\n            this.collection.name,\r\n            query\r\n        )\r\n\r\n        collection.removeFromCache(this.id)\r\n        \r\n        this.id = null\r\n        return ret\r\n    }\r\n}"],"file":"Model.js"}