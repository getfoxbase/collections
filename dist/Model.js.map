{"version":3,"sources":["../src/Model.js"],"names":["Model","constructor","collectionName","data","driver","id","getCollection","Collection","get","key","defaultValue","set","value","save","collection","query","getPrimaryKeyName","formatPrimaryKey","ret","update","formatIn","insert","getPrimaryKey","cached","addToCache","delete","removeFromCache"],"mappings":";;;;;;;AAAA;;;;;;;;AAEe,MAAMA,KAAN,CAAY;AACvBC,EAAAA,WAAW,CAACC,cAAD,EAAiBC,IAAjB,EAAuBC,MAAvB,EAA+B;AAAA;;AACtC,SAAKA,MAAL,GAAcA,MAAd;AACA,SAAKF,cAAL,GAAsBA,cAAtB;AACA,SAAKC,IAAL,GAAYA,IAAZ;AACA,SAAKE,EAAL,eAAUF,IAAI,CAACE,EAAf,+CAAqB,IAArB;AACH;;AAEDC,EAAAA,aAAa,GAAG;AACZ,WAAOC,oBAAWC,GAAX,CAAe,KAAKN,cAApB,CAAP;AACH;;AAEDM,EAAAA,GAAG,CAACC,GAAD,EAAMC,YAAY,GAAG,IAArB,EAA2B;AAAA;;AAC1B,6BAAO,KAAKP,IAAL,CAAUM,GAAV,CAAP,2DAAyBC,YAAzB;AACH;;AAEDC,EAAAA,GAAG,CAACF,GAAD,EAAMG,KAAN,EAAa;AACZ,SAAKT,IAAL,CAAUM,GAAV,IAAiBG,KAAjB;AACH;;AAEKC,EAAAA,IAAI,GAAG;AAAA;;AAAA;AACT,YAAMC,UAAU,GAAGP,oBAAWC,GAAX,CAAe,KAAI,CAACN,cAApB,CAAnB;;AAEA,UAAI,KAAI,CAACG,EAAL,KAAY,IAAhB,EAAsB;AAAE;AACpB,cAAMU,KAAK,GAAG,EAAd;AACAA,QAAAA,KAAK,CAAC,KAAI,CAACX,MAAL,CAAYY,iBAAZ,EAAD,CAAL,GAAyC,KAAI,CAACZ,MAAL,CAAYa,gBAAZ,CAA6B,KAAI,CAACZ,EAAlC,CAAzC;AACA,cAAMa,GAAG,SAAS,KAAI,CAACd,MAAL,CAAYe,MAAZ,CACd,KAAI,CAACjB,cADS,EAEda,KAFc,QAGRD,UAAU,CAACM,QAAX,CAAoB,KAAI,CAACjB,IAAzB,CAHQ,CAAlB;AAKH,OARD,MAQO;AAAE;AACL,cAAMe,GAAG,SAAS,KAAI,CAACd,MAAL,CAAYiB,MAAZ,CACd,KAAI,CAACnB,cADS,QAERY,UAAU,CAACM,QAAX,CAAoB,KAAI,CAACjB,IAAzB,CAFQ,CAAlB;AAIA,QAAA,KAAI,CAACE,EAAL,GAAU,KAAI,CAACD,MAAL,CAAYkB,aAAZ,CAA0BJ,GAA1B,CAAV;AAEA,YAAIJ,UAAU,CAACS,MAAf,EACIT,UAAU,CAACU,UAAX,CAAsB,KAAtB;AACP;;AAED,aAAO,IAAP;AAtBS;AAuBZ;;AAEKC,EAAAA,MAAM,GAAG;AAAA;;AAAA;AACX,UAAI,MAAI,CAACpB,EAAL,KAAY,IAAhB,EACI,OAAO,KAAP;AAEJ,YAAMU,KAAK,GAAG,EAAd;AACAA,MAAAA,KAAK,CAAC,MAAI,CAACX,MAAL,CAAYY,iBAAZ,EAAD,CAAL,GAAyC,MAAI,CAACZ,MAAL,CAAYa,gBAAZ,CAA6B,MAAI,CAACZ,EAAlC,CAAzC;;AAEA,YAAMS,UAAU,GAAG,MAAI,CAACR,aAAL,EAAnB;;AACA,YAAMY,GAAG,SAAS,MAAI,CAACd,MAAL,CAAYqB,MAAZ,CACd,MAAI,CAACvB,cADS,EAEda,KAFc,CAAlB;AAKA,UAAID,UAAU,CAACS,MAAf,EACIT,UAAU,CAACY,eAAX,CAA2B,MAAI,CAACrB,EAAhC;AAEJ,MAAA,MAAI,CAACA,EAAL,GAAU,IAAV;AACA,aAAOa,GAAP;AAjBW;AAkBd;;AA/DsB","sourcesContent":["import Collection from \"./Collection\"\r\n\r\nexport default class Model {\r\n    constructor(collectionName, data, driver) {\r\n        this.driver = driver\r\n        this.collectionName = collectionName\r\n        this.data = data\r\n        this.id = data.id ?? null\r\n    }\r\n\r\n    getCollection() {\r\n        return Collection.get(this.collectionName)\r\n    }\r\n\r\n    get(key, defaultValue = null) {\r\n        return this.data[key] ?? defaultValue\r\n    }\r\n\r\n    set(key, value) {\r\n        this.data[key] = value\r\n    }\r\n\r\n    async save() {\r\n        const collection = Collection.get(this.collectionName)\r\n\r\n        if (this.id !== null) { // Update\r\n            const query = {}\r\n            query[this.driver.getPrimaryKeyName()] = this.driver.formatPrimaryKey(this.id)\r\n            const ret = await this.driver.update(\r\n                this.collectionName,\r\n                query,\r\n                await collection.formatIn(this.data)\r\n            )\r\n        } else { // Insert\r\n            const ret = await this.driver.insert(\r\n                this.collectionName,\r\n                await collection.formatIn(this.data)\r\n            )\r\n            this.id = this.driver.getPrimaryKey(ret)\r\n\r\n            if (collection.cached)\r\n                collection.addToCache(this)\r\n        }\r\n        \r\n        return true\r\n    }\r\n\r\n    async delete() {\r\n        if (this.id === null)\r\n            return false\r\n        \r\n        const query = {}\r\n        query[this.driver.getPrimaryKeyName()] = this.driver.formatPrimaryKey(this.id)\r\n\r\n        const collection = this.getCollection()\r\n        const ret = await this.driver.delete(\r\n            this.collectionName,\r\n            query\r\n        )\r\n\r\n        if (collection.cached)\r\n            collection.removeFromCache(this.id)\r\n        \r\n        this.id = null\r\n        return ret\r\n    }\r\n}"],"file":"Model.js"}