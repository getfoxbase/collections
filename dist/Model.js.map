{"version":3,"sources":["../src/Model.js"],"names":["Model","constructor","collection","data","driver","id","getCollection","get","key","defaultValue","Dot","set","value","push","arr","Array","filter","a","setMany","o","matches","query","export","save","getPrimaryKeyName","formatPrimaryKey","ret","update","name","formatIn","insert","getPrimaryKey","addToCache","delete","removeFromCache"],"mappings":";;;;;;;AAAA;;AACA;;;;;;;;AAEe,MAAMA,KAAN,CAAY;AACvBC,EAAAA,WAAW,CAACC,UAAD,EAAaC,IAAb,EAAmB;AAAA;;AAC1B,SAAKD,UAAL,GAAkBA,UAAlB;AACA,SAAKE,MAAL,GAAcF,UAAU,CAACE,MAAzB;AACA,SAAKD,IAAL,GAAYA,IAAZ;AACA,SAAKE,EAAL,eAAUF,IAAI,CAACE,EAAf,+CAAqB,IAArB;AACH;;AAEDC,EAAAA,aAAa,GAAG;AACZ,WAAO,KAAKJ,UAAZ;AACH;;AAEDK,EAAAA,GAAG,CAACC,GAAD,EAAMC,YAAY,GAAG,IAArB,EAA2B;AAAA;;AAC1B,uBAAOC,aAAIH,GAAJ,CAAQ,KAAKJ,IAAb,EAAmBK,GAAnB,CAAP,+CAAkCC,YAAlC;AACH;;AAEDE,EAAAA,GAAG,CAACH,GAAD,EAAMI,KAAN,EAAa;AACZF,iBAAIC,GAAJ,CAAQ,KAAKR,IAAb,EAAmBK,GAAnB,EAAwBI,KAAxB;;AACA,WAAO,IAAP;AACH;;AAEDC,EAAAA,IAAI,CAACL,GAAD,EAAMI,KAAN,EAAa;AACb,UAAME,GAAG,GAAG,KAAKP,GAAL,CAASC,GAAT,EAAc,EAAd,CAAZ;;AACA,QAAIM,GAAG,YAAYC,KAAf,KAAyB,KAA7B,EAAoC;AAChCD,MAAAA,GAAG,GAAG,CAACA,GAAD,EAAME,MAAN,CAAaC,CAAC,IAAIA,CAAC,KAAK,IAAxB,CAAN;AACH;;AACDH,IAAAA,GAAG,CAACD,IAAJ,CAASD,KAAT;AACA,SAAKD,GAAL,CAASH,GAAT,EAAcM,GAAd;AACA,WAAO,IAAP;AACH;;AAEDI,EAAAA,OAAO,CAACC,CAAD,EAAI;AACP,SAAK,IAAIX,GAAT,IAAgBW,CAAhB,EACIT,aAAIC,GAAJ,CAAQ,KAAKR,IAAb,EAAmBK,GAAnB,EAAwBW,CAAC,CAACX,GAAD,CAAzB;;AACJ,WAAO,IAAP;AACH;;AAEDY,EAAAA,OAAO,CAACC,KAAK,GAAG,EAAT,EAAa;AAChB,WAAO,mBAAKA,KAAL,EAAY,KAAKlB,IAAjB,CAAP;AACH;;AAEDmB,EAAAA,MAAM,GAAG;AACL,WAAO,KAAKnB,IAAZ;AACH;;AAEKoB,EAAAA,IAAI,GAAG;AAAA;;AAAA;AACT,UAAI,KAAI,CAAClB,EAAL,KAAY,IAAhB,EAAsB;AAAE;AACpB,cAAMgB,KAAK,GAAG,EAAd;AACAA,QAAAA,KAAK,CAAC,KAAI,CAACjB,MAAL,CAAYoB,iBAAZ,EAAD,CAAL,GAAyC,KAAI,CAACpB,MAAL,CAAYqB,gBAAZ,CAA6B,KAAI,CAACpB,EAAlC,CAAzC;AACA,cAAMqB,GAAG,SAAS,KAAI,CAACtB,MAAL,CAAYuB,MAAZ,CACd,KAAI,CAACzB,UAAL,CAAgB0B,IADF,EAEdP,KAFc,QAGR,KAAI,CAACnB,UAAL,CAAgB2B,QAAhB,CAAyB,KAAI,CAAC1B,IAA9B,CAHQ,CAAlB;AAKH,OARD,MAQO;AAAE;AACL,cAAMuB,GAAG,SAAS,KAAI,CAACtB,MAAL,CAAY0B,MAAZ,CACd,KAAI,CAAC5B,UAAL,CAAgB0B,IADF,QAER,KAAI,CAAC1B,UAAL,CAAgB2B,QAAhB,CAAyB,KAAI,CAAC1B,IAA9B,CAFQ,CAAlB;AAIA,QAAA,KAAI,CAACE,EAAL,GAAU,KAAI,CAACD,MAAL,CAAY2B,aAAZ,CAA0BL,GAA1B,CAAV;AACA,QAAA,KAAI,CAACvB,IAAL,CAAUE,EAAV,GAAe,KAAI,CAACA,EAApB;;AAEA,QAAA,KAAI,CAACH,UAAL,CAAgB8B,UAAhB,CAA2B,KAA3B;AACH;;AAED,aAAO,IAAP;AApBS;AAqBZ;;AAEKC,EAAAA,MAAM,GAAG;AAAA;;AAAA;AACX,UAAI,MAAI,CAAC5B,EAAL,KAAY,IAAhB,EACI,OAAO,KAAP;AAEJ,YAAMgB,KAAK,GAAG,EAAd;AACAA,MAAAA,KAAK,CAAC,MAAI,CAACjB,MAAL,CAAYoB,iBAAZ,EAAD,CAAL,GAAyC,MAAI,CAACpB,MAAL,CAAYqB,gBAAZ,CAA6B,MAAI,CAACpB,EAAlC,CAAzC;;AAEA,YAAMH,UAAU,GAAG,MAAI,CAACI,aAAL,EAAnB;;AACA,YAAMoB,GAAG,SAAS,MAAI,CAACtB,MAAL,CAAY6B,MAAZ,CACd,MAAI,CAAC/B,UAAL,CAAgB0B,IADF,EAEdP,KAFc,CAAlB;AAKAnB,MAAAA,UAAU,CAACgC,eAAX,CAA2B,MAAI,CAAC7B,EAAhC;AAEA,MAAA,MAAI,CAACA,EAAL,GAAU,IAAV;AACA,aAAOqB,GAAP;AAhBW;AAiBd;;AArFsB","sourcesContent":["import sift from 'sift'\r\nimport Dot from './Tools/Dot'\r\n\r\nexport default class Model {\r\n    constructor(collection, data) {\r\n        this.collection = collection\r\n        this.driver = collection.driver\r\n        this.data = data\r\n        this.id = data.id ?? null\r\n    }\r\n\r\n    getCollection() {\r\n        return this.collection\r\n    }\r\n\r\n    get(key, defaultValue = null) {\r\n        return Dot.get(this.data, key) ?? defaultValue\r\n    }\r\n\r\n    set(key, value) {\r\n        Dot.set(this.data, key, value)\r\n        return this\r\n    }\r\n\r\n    push(key, value) {\r\n        const arr = this.get(key, [])\r\n        if (arr instanceof Array === false) {\r\n            arr = [arr].filter(a => a !== null)\r\n        }\r\n        arr.push(value)\r\n        this.set(key, arr)\r\n        return this\r\n    }\r\n\r\n    setMany(o) {\r\n        for (let key in o)\r\n            Dot.set(this.data, key, o[key])\r\n        return this\r\n    }\r\n\r\n    matches(query = {}) {\r\n        return sift(query)(this.data)\r\n    }\r\n\r\n    export() {\r\n        return this.data\r\n    }\r\n\r\n    async save() {\r\n        if (this.id !== null) { // Update\r\n            const query = {}\r\n            query[this.driver.getPrimaryKeyName()] = this.driver.formatPrimaryKey(this.id)\r\n            const ret = await this.driver.update(\r\n                this.collection.name,\r\n                query,\r\n                await this.collection.formatIn(this.data)\r\n            )\r\n        } else { // Insert\r\n            const ret = await this.driver.insert(\r\n                this.collection.name,\r\n                await this.collection.formatIn(this.data)\r\n            )\r\n            this.id = this.driver.getPrimaryKey(ret)\r\n            this.data.id = this.id\r\n\r\n            this.collection.addToCache(this)\r\n        }\r\n        \r\n        return true\r\n    }\r\n\r\n    async delete() {\r\n        if (this.id === null)\r\n            return false\r\n        \r\n        const query = {}\r\n        query[this.driver.getPrimaryKeyName()] = this.driver.formatPrimaryKey(this.id)\r\n\r\n        const collection = this.getCollection()\r\n        const ret = await this.driver.delete(\r\n            this.collection.name,\r\n            query\r\n        )\r\n\r\n        collection.removeFromCache(this.id)\r\n        \r\n        this.id = null\r\n        return ret\r\n    }\r\n}"],"file":"Model.js"}